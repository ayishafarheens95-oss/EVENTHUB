<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kalvium EventHub</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

  <!-- Header -->
  <header class="bg-indigo-600 text-white py-4 shadow-md">
    <h1 class="text-center text-3xl font-bold">üéâ Kalvium EventHub</h1>
  </header>

  <!-- Main Container -->
  <main class="flex flex-col md:flex-row flex-1 p-6 gap-6">

    <!-- Event Form -->
    <section class="md:w-1/3 bg-white rounded-2xl shadow-lg p-6">
      <h2 class="text-xl font-semibold mb-4 text-indigo-700">Create New Event</h2>
      <form id="eventForm" class="space-y-4">
        <label for="title" class="sr-only">Event Title *</label>
        <input
          type="text"
          id="title"
          placeholder="Event Title *"
          required
          class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"
        />

        <label for="description" class="sr-only">Description (optional)</label>
        <textarea
          id="description"
          placeholder="Description (optional)"
          class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"
        ></textarea>

        <label for="date" class="sr-only">Date and Time *</label>
        <input
          type="datetime-local"
          id="date"
          required
          class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"
        />

        <label for="location" class="sr-only">Location *</label>
        <input
          type="text"
          id="location"
          placeholder="Location *"
          required
          class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"
        />

        <label for="maxAttendees" class="sr-only">Max Attendees *</label>
        <input
          type="number"
          id="maxAttendees"
          placeholder="Max Attendees *"
          required
          min="1"
          class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"
        />

        <button
          type="submit"
          class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-lg font-semibold transition"
        >
          ‚ûï Add Event
        </button>
      </form>
      <p id="message" class="mt-3 text-sm text-gray-600"></p>
    </section>

    <!-- Event List -->
    <section class="md:w-2/3">
      <h2 class="text-xl font-semibold mb-4 text-indigo-700">Upcoming Events</h2>
      <div id="eventsList" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <p class="col-span-full text-gray-500" id="loadingMsg">Loading events...</p>
      </div>
    </section>
  </main>

  <script>
    // Replace this with your actual deployed backend API URL
    const apiBase = "https://event-api-yourname.onrender.com/api/events";

    const eventForm = document.getElementById("eventForm");
    const message = document.getElementById("message");
    const eventsList = document.getElementById("eventsList");
    const loadingMsg = document.getElementById("loadingMsg");

    // Fetch and display events
    async function loadEvents() {
      eventsList.innerHTML = "";
      loadingMsg.style.display = "block";
      try {
        const res = await fetch(apiBase);
        if (!res.ok) throw new Error("Network response was not ok");
        const events = await res.json();
        loadingMsg.style.display = "none";
        if (events.length === 0) {
          eventsList.innerHTML =
            "<p class='text-gray-500 col-span-full'>No events yet.</p>";
          return;
        }
        events.forEach((ev) => {
          const card = document.createElement("div");
          card.className =
            "bg-white p-4 rounded-xl shadow hover:shadow-md transition";
          card.innerHTML = `
            <h3 class="text-lg font-bold text-indigo-600">${ev.title}</h3>
            <p class="text-gray-600">${ev.description || "No description"}</p>
            <p class="mt-2 text-sm"><strong>üìç Location:</strong> ${ev.location}</p>
            <p class="text-sm"><strong>üìÖ Date:</strong> ${new Date(
              ev.date
            ).toLocaleString()}</p>
            <p class="text-sm"><strong>üë• Attendees:</strong> ${ev.currentAttendees}/${
            ev.maxAttendees
          }</p>
            <span class="inline-block mt-2 px-2 py-1 text-xs rounded-full ${
              ev.status === "upcoming"
                ? "bg-green-100 text-green-700"
                : "bg-gray-200 text-gray-700"
            }">${ev.status}</span>
          `;
          eventsList.appendChild(card);
        });
      } catch (error) {
        loadingMsg.style.display = "none";
        eventsList.innerHTML =
          "<p class='text-red-500 col-span-full'>Failed to load events.</p>";
      }
    }

    // Handle form submission
    eventForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      message.textContent = "Submitting...";
      try {
        const newEvent = {
          title: document.getElementById("title").value.trim(),
          description: document.getElementById("description").value.trim(),
          date: document.getElementById("date").value,
          location: document.getElementById("location").value.trim(),
          maxAttendees: parseInt(
            document.getElementById("maxAttendees").value,
            10
          ),
        };
        const res = await fetch(apiBase, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(newEvent),
        });
        if (res.ok) {
          message.textContent = "‚úÖ Event created successfully!";
          eventForm.reset();
          loadEvents();
        } else {
          const err = await res.json();
          message.textContent = "‚ùå " + (err.error || "Failed to create event.");
        }
      } catch (error) {
        message.textContent = "‚ùå Network error. Try again.";
      }
    });

    // Initial load
    loadEvents();
  </script>
</body>
</html>
